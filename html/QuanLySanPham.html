<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quản Lý Sản Phẩm</title>
    <!-- Bootstrap 5 CSS -->
    <link href="../css/bootstrap.css" rel="stylesheet" />
    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <!-- Google Fonts -->
    <link href="../css/QuanLySanPham.css" rel="stylesheet" />
    <link rel="stylesheet" href="../css/index.css" />
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="logo">Medicine</div>
      <a href="#"><i class="fas fa-exclamation-triangle"></i>Link</a>
      <a href="#"><i class="fas fa-users"></i> Link</a>
      <a href="#"><i class="fas fa-capsules"></i> Link</a>
      <a href="#"><i class="fas fa-prescription-bottle"></i>Link</a>
      <a href="#"><i class="fas fa-file-invoice"></i>Link</a>
      <a href="#"><i class="fas fa-users"></i>Link</a>
      <a href="#"><i class="fas fa-shopping-cart"></i>Link</a>
      <a href="#"><i class="fas fa-tags"></i>Link</a>
    </div>

    <!-- Main Content -->
    <div class="content">
      <!-- Header -->
      <div class="header">
        <h2>Quản Lý Sản Phẩm</h2>
        <button
          class="btn btn-primary"
          data-bs-toggle="modal"
          data-bs-target="#logoutModal"
        >
          <i class="fas fa-sign-out-alt me-2"></i> Đăng xuất
        </button>
      </div>

      <!-- Search and Add Button -->
      <div class="search-bar">
        <input
          type="text"
          id="searchInput"
          placeholder="Tìm kiếm theo tên sản phẩm..."
          onkeyup="searchProducts()"
        />
        <button
          class="btn btn-primary"
          data-bs-toggle="modal"
          data-bs-target="#addProductModal"
        >
          <i class="fas fa-plus me-2"></i> Thêm Sản Phẩm
        </button>
      </div>

      <!-- Product Table -->
      <div class="card">
        <div class="card-body p-0">
          <table class="table">
            <thead>
              <tr>
                <th>STT</th>
                <th>Mã Sản Phẩm</th>
                <th>Tên Sản Phẩm</th>
                <th>Số Lượng Tồn Kho</th>
                <th>Hạn Sử Dụng</th>
                <th>Giá Bán</th>
                <th>Hành Động</th>
              </tr>
            </thead>
            <tbody id="productTableBody">
              <!-- Data will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Modal for Adding Product -->
    <div
      class="modal fade"
      id="addProductModal"
      tabindex="-1"
      aria-labelledby="addProductModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addProductModalLabel">Thêm Sản Phẩm</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addProductForm">
              <div class="mb-3">
                <label for="productCode" class="form-label">Mã Sản Phẩm</label>
                <input
                  type="text"
                  class="form-control"
                  id="productCode"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="productName" class="form-label">Tên Sản Phẩm</label>
                <input
                  type="text"
                  class="form-control"
                  id="productName"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="productQuantity" class="form-label"
                  >Số Lượng Tồn Kho</label
                >
                <input
                  type="number"
                  class="form-control"
                  id="productQuantity"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="productExpiry" class="form-label"
                  >Hạn Sử Dụng</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="productExpiry"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="productPrice" class="form-label"
                  >Giá Bán (VND)</label
                >
                <input
                  type="number"
                  class="form-control"
                  id="productPrice"
                  required
                />
              </div>
              <button type="submit" class="btn btn-primary w-100">
                Thêm Sản Phẩm
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal for Editing Product -->
    <div
      class="modal fade"
      id="editProductModal"
      tabindex="-1"
      aria-labelledby="editProductModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editProductModalLabel">Sửa Sản Phẩm</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="editProductForm">
              <input type="hidden" id="editProductId" />
              <div class="mb-3">
                <label for="editProductCode" class="form-label"
                  >Mã Sản Phẩm</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="editProductCode"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="editProductName" class="form-label"
                  >Tên Sản Phẩm</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="editProductName"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="editProductQuantity" class="form-label"
                  >Số Lượng Tồn Kho</label
                >
                <input
                  type="number"
                  class="form-control"
                  id="editProductQuantity"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="editProductExpiry" class="form-label"
                  >Hạn Sử Dụng</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="editProductExpiry"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="editProductPrice" class="form-label"
                  >Giá Bán (VND)</label
                >
                <input
                  type="number"
                  class="form-control"
                  id="editProductPrice"
                  required
                />
              </div>
              <button type="submit" class="btn btn-primary w-100">
                Lưu Thay Đổi
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap 5 JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    <script>
      // Sample data for products
      let products = [
        {
          id: 1,
          code: "ASP001",
          name: "Aspirin",
          quantity: 199,
          expiry: "2025-11-15",
          price: 25000,
        },
        {
          id: 2,
          code: "EFF002",
          name: "Efferfangan",
          quantity: 50,
          expiry: "2025-12-31",
          price: 12000,
        },
        {
          id: 3,
          code: "IBU003",
          name: "Ibuprofen",
          quantity: 100,
          expiry: "2025-06-30",
          price: 30000,
        },
        {
          id: 4,
          code: "MUL004",
          name: "Multi Vitamin",
          quantity: 200,
          expiry: "2025-11-15",
          price: 60000,
        },
        {
          id: 5,
          code: "PAN005",
          name: "Panadol",
          quantity: 100,
          expiry: "2025-06-30",
          price: 10000,
        },
        {
          id: 6,
          code: "PAR006",
          name: "Paracetamol",
          quantity: 50,
          expiry: "2025-12-31",
          price: 15000,
        },
        {
          id: 7,
          code: "PRE007",
          name: "Prednisone",
          quantity: 150,
          expiry: "2025-08-20",
          price: 18000,
        },
      ];

      // Sort products by quantity (ascending) initially
      products.sort((a, b) => a.quantity - b.quantity);

      // Function to render table
      function renderTable(data = products) {
        const tableBody = document.getElementById("productTableBody");
        tableBody.innerHTML = "";
        data.forEach((product, index) => {
          const row = `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${product.code}</td>
                        <td>${product.name}</td>
                        <td>${product.quantity}</td>
                        <td>${product.expiry}</td>
                        <td>${product.price.toLocaleString()} VND</td>
                        <td>
                            <button class="btn btn-success btn-sm me-2" onclick="editProduct(${
                              product.id
                            })">
                                <i class="fas fa-edit"></i> Sửa
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteProduct(${
                              product.id
                            })">
                                <i class="fas fa-trash"></i> Xóa
                            </button>
                        </td>
                    </tr>
                `;
          tableBody.innerHTML += row;
        });
      }

      // Search Products
      function searchProducts() {
        const searchTerm = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const filteredProducts = products.filter((product) =>
          product.name.toLowerCase().includes(searchTerm)
        );
        renderTable(filteredProducts);
      }

      // Add Product
      document
        .getElementById("addProductForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const code = document.getElementById("productCode").value;
          const name = document.getElementById("productName").value;
          const quantity = document.getElementById("productQuantity").value;
          const expiry = document.getElementById("productExpiry").value;
          const price = document.getElementById("productPrice").value;

          const newProduct = {
            id: products.length ? products[products.length - 1].id + 1 : 1,
            code,
            name,
            quantity: parseInt(quantity),
            expiry,
            price: parseInt(price),
          };

          products.push(newProduct);
          products.sort((a, b) => a.quantity - b.quantity); // Sort after adding
          renderTable();
          bootstrap.Modal.getInstance(
            document.getElementById("addProductModal")
          ).hide();
          document.getElementById("addProductForm").reset();
        });

      // Edit Product
      function editProduct(id) {
        const product = products.find((p) => p.id === id);
        document.getElementById("editProductId").value = product.id;
        document.getElementById("editProductCode").value = product.code;
        document.getElementById("editProductName").value = product.name;
        document.getElementById("editProductQuantity").value = product.quantity;
        document.getElementById("editProductExpiry").value = product.expiry;
        document.getElementById("editProductPrice").value = product.price;

        const editModal = new bootstrap.Modal(
          document.getElementById("editProductModal")
        );
        editModal.show();
      }

      document
        .getElementById("editProductForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const id = parseInt(document.getElementById("editProductId").value);
          const code = document.getElementById("editProductCode").value;
          const name = document.getElementById("editProductName").value;
          const quantity = document.getElementById("editProductQuantity").value;
          const expiry = document.getElementById("editProductExpiry").value;
          const price = document.getElementById("editProductPrice").value;

          const productIndex = products.findIndex((p) => p.id === id);
          products[productIndex] = {
            id,
            code,
            name,
            quantity: parseInt(quantity),
            expiry,
            price: parseInt(price),
          };
          products.sort((a, b) => a.quantity - b.quantity); // Sort after editing
          renderTable();
          bootstrap.Modal.getInstance(
            document.getElementById("editProductModal")
          ).hide();
        });

      // Delete Product
      function deleteProduct(id) {
        if (confirm("Bạn có chắc chắn muốn xóa sản phẩm này?")) {
          products = products.filter((product) => product.id !== id);
          products.sort((a, b) => a.quantity - b.quantity); // Sort after deleting
          renderTable();
        }
      }

      // Initial render
      renderTable();
    </script>
  </body>
</html>
